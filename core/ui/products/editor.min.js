/*
 * editor.js - Product editor behaviors
 * Copyright Â© 2008-2010 by Ingenesis Limited
 * Licensed under the GPLv3 (or later) {@see license.txt}
 **/
function categories(){jQuery("#product .category-metabox").each(function(){var a=jqnc(),b=a(this),c=a(this).attr("id").split("-").slice(1).join("-"),e=b.find("div.new-category").hide(),f=b.find("ul.category-tabs"),h=(f.find("li a").click(function(b){b.preventDefault();var c=a(this),d=c.attr("href");c.parent().addClass("tabs").siblings("li").removeClass("tabs"),a(d).show().siblings("div.tabs-panel").hide(),c.parent().hasClass("new-category")?e.slideDown("fast",function(){e.find("input").focus()}):e.hide()}),function(b){return a("#new-"+c+"-name").val()?(b.data+="&"+a(":checked","#"+c+"-checklist").serialize(),b):!1}),i=function(b,d){var e,f=a("#new"+c+"_parent");"undefined"!=d.parsed.responses[0]&&(e=d.parsed.responses[0].supplemental.newcat_parent)&&(f.before(e),f.remove())};a("#"+c+"-checklist").wpList({alt:"",response:c+"-ajax-response",addBefore:h,addAfter:i}),f.find("li.tabs a").click(),a("#"+c+"-checklist li.popular-category :checkbox, #"+c+"-checklist-pop :checkbox").live("click",function(){var b=a(this),d=b.is(":checked"),e=b.val();e&&b.parents("#taxonomy-"+c).length&&a("#in-"+c+"-"+e+", #in-popular-"+c+"-"+e).attr("checked",d)})}),jQuery(".category-metabox input[type=checkbox]").change(function(){if(!this.checked)return!0;var b,a=jqnc(),c=Array();a("#details-menu").children().children().find("input.label").each(function(b,d){c.push(a(d).val())}),b=a(this).val(),a.getJSON(spectemp_url+"&action=shopp_spec_template&category="+b,function(a){if(!a)return!0;for(b in a)a[b].add=!0,-1==(""+c).search(a[b].name)&&addDetail(a[b])}),a.getJSON(opttemp_url+"&action=shopp_options_template&category="+b,function(b){if(!(b&&b.options&&b.prices&&(b.options.length>0||b.prices.length>0)))return!0;var c=a("#variations-setting"),d=b.options.v?b.options.v:b.options,e=!1;c.attr("checked")||c.attr("checked",!0).trigger("toggleui"),optionMenus.length>0?a.each(d,function(b,c){c&&c.name&&c.options&&((menu=optionMenuExists(c.name))?(e=!1,a.each(c.options,function(a,b){b&&b.name&&(optionMenuItemExists(menu,b.name)||(menu.addOption(b),e=!0))}),e&&addVariationPrices()):(delete c.id,a.each(c.options,function(a,b){b&&b.name&&delete b.id}),addVariationOptionsMenu(c)))}):loadVariations(d,b.prices)})})}function tags(){jQuery("#product .tags-metabox").each(function(){var a=jqnc(),b=a(this),c=a(this).attr("id").split("-").slice(1).join("-"),d=b.find(".tags"),e=d.val().split(","),f=new SearchSelector({source:"shopp_tags",parent:b,url:tagsugg_url,fieldname:"tax_input["+c+"]",label:TAG_SEARCHSELECT_LABEL,classname:"tags",freeform:!0,autosuggest:"shopp_popular_tags"});d.val(""),a.each(e,function(a,b){0!=b.length&&f.ui.prepend(f.newItem("",b))})})}var Pricelines=new Pricelines,productOptions=Array(),productAddons=Array(),optionMenus=Array(),addonGroups=Array(),addonOptionsGroup=Array(),selectedMenuOption=!1,detailsidx=1,variationsidx=1,addon_group_idx=1,addonsidx=1,optionsidx=1,pricingidx=1,fileUploader=!1,changes=!1,saving=!1,flashUploader=!1,template=!1,fileUploads=!1,changesMade=!1,isSave=!1;jQuery(document).ready(function(a){var b=a("#title"),c=a("#title-prompt-text"),d=a(".publishdate");b.bind("focus keydown",function(){c.hide()}).blur(function(){""==b.val()?c.show():c.hide()}),product||(b.focus(),c.show()),postboxes.add_postbox_toggles(screenid),a(".if-js-closed").removeClass("if-js-closed").addClass("closed"),a(".postbox a.help").click(function(){return a(this).colorbox({iframe:!0,open:!0,innerWidth:768,innerHeight:480,scrolling:!1}),!1}),a('<div id="publish-calendar" class="calendar"></div>').appendTo("#wpwrap").PopupCalendar({m_input:a("#publish-month"),d_input:a("#publish-date"),y_input:a("#publish-year"),autoinit:!0,title:calendarTitle,startWeek:startWeekday}),a("#schedule-toggle").click(function(){a("#scheduling").slideToggle("fast",function(){a(this).is(":visible")?d.removeAttr("disabled"):d.attr("disabled",!0)})}),a("#scheduling").hide(),d.attr("disabled",!0),a("#published").change(function(){a(this).attr("checked")?a("#publish-status,#schedule-toggling").show():a("#publish-status,#schedule-toggling,#scheduling").hide()}).change(),a("#process-time").change(function(){var b=a("#processing");a(this).attr("checked")?b.slideDown("fast"):b.hide()}).change(),editslug=new SlugEditor(product,"product"),specs&&a.each(specs,function(){addDetail(this)}),a("#addDetail").click(function(){addDetail()}),fileUploads=new FileUploader("flash-upload-file",a("#ajax-upload-file")),basePrice=a(prices).get(0),basePrice&&"product"==basePrice.context?Pricelines.add(!1,basePrice,"#product-pricing"):Pricelines.add(!1,!1,"#product-pricing"),a("#variations-setting").bind("toggleui",variationsToggle).click(function(){a(this).trigger("toggleui")}).trigger("toggleui"),loadVariations(options&&(options.v||options.a)?options.v:options,prices),a("#addVariationMenu").click(function(){addVariationOptionsMenu()}),a("#linkOptionVariations").click(linkVariationsButton).change(linkVariationsButtonLabel),a("#addons-setting").bind("toggleui",addonsToggle).click(function(){a(this).trigger("toggleui")}).trigger("toggleui"),a("#newAddonGroup").click(function(){newAddonGroup()}),options&&options.a&&loadAddons(options.a,prices),imageUploads=new ImageUploads(a("#image-product-id").val(),"product"),categories(),tags(),quickSelects(),a("#product").change(function(){changes=!0}).unbind("submit").submit(function(b){b.stopPropagation();var c=a("#product").attr("action").split("?"),d=c[0]+"?"+a.param(request);return a("#product")[0].setAttribute("action",d),saving=!0,!0}),a("#prices-loading").remove(),a("input").on("change",function(){changesMade=!0,a(this).off("change")}),a("input[name='save']").click(function(){isSave=!0}),window.onbeforeunload=function(){var a="undefined"!=typeof tinymce?tinymce.activeEditor:!1;return!isSave&&(changesMade||a&&a.isDirty()&&!a.isHidden())?$msg.confirm:void 0}});